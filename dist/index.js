#!/usr/bin/env node
"use strict";

var _pentesterlandWriteupsScraper = _interopRequireDefault(require("pentesterland-writeups-scraper"));

var _yargs = _interopRequireDefault(require("yargs"));

var _pick = _interopRequireDefault(require("lodash/pick"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const fields = ['url', 'title', 'published', 'published_at', 'bounty', 'hackers', 'programs', 'weaknesses'];
_yargs.default.scriptName('pentesterland').usage('$0 <cmd> [args]').command('list', 'Get list of writeups', {
  limit: {
    alias: 'l',
    type: 'number'
  },
  pretty: {
    alias: 'p',
    type: 'boolean',
    default: false
  },
  group: {
    alias: 'g',
    type: 'boolean',
    default: false
  },
  title: {
    alias: 't',
    type: 'string'
  },
  year: {
    alias: 'y',
    type: 'string'
  },
  month: {
    alias: 'm',
    type: 'string'
  },
  order: {
    alias: 'o',
    choices: ['asc', 'desc'],
    default: 'desc'
  },
  fields: {
    alias: 'f',
    type: 'array',
    choices: fields
  }
}, async options => {
  let writeups = await (0, _pentesterlandWriteupsScraper.default)((0, _pick.default)(options, ['year', 'month', 'group', 'order', 'title']));

  if (Array.isArray(writeups)) {
    if (options.limit) {
      writeups = writeups.slice(0, options.limit);
    }

    if (options.fields) {
      writeups = writeups.map(item => (0, _pick.default)(item, options.fields));
    }
  }

  console.log(JSON.stringify(writeups, undefined, options.pretty ? 3 : 0));
}).help().argv;